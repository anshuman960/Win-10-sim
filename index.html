<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Windows 10 Simulator</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  html, body {
    margin: 0; padding: 0; width: 100vw; height: 100vh; overflow: hidden;
    font-family: 'Segoe UI', Arial, sans-serif;
    background: #276ac6;
  }
  #desktop {
    width: 100vw; height: 100vh; position: relative; overflow: hidden;
  }
  #wallpaper {
    position: absolute; width: 100vw; height: 100vh; left: 0; top: 0;
    object-fit: cover; z-index: 0; user-select: none; pointer-events: none;
  }
  #taskbar {
    position: absolute; bottom: 0; left: 0; width: 100vw; height: 46px;
    background: rgba(34,43,68,0.96);
    display: flex; align-items: center; z-index: 2;
  }
  #startBtn {
    margin-left: 10px; width: 40px; height: 40px;
    background: none; border: none; padding: 0; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
  }
  #startBtn svg {
    width: 32px; height: 32px; display: block;
  }
  #desktopIcons {
    position: absolute; top: 24px; left: 20px; z-index: 1;
    display: flex; flex-direction: column; gap: 18px;
  }
  .icon {
    display: flex; flex-direction: column; align-items: center;
    width: 76px; cursor: pointer; user-select: none;
    color: #fff; text-shadow: 0 1px 7px #000a;
  }
  .icon svg {
    width: 38px; height: 38px; margin-bottom: 4px;
    background: #1d6bbb99; border-radius: 7px; padding: 3px; box-sizing: content-box;
  }
  .icon span {
    font-size: 13px; margin-top: 0; text-align: center; word-break: break-word;
  }
  #startMenu {
    position: absolute; left: 10px; bottom: 60px; width: 260px;
    background: rgba(36,39,68,0.97);
    color: #fff;
    border-radius: 14px 14px 0 0;
    box-shadow: 0 9px 30px #0007;
    z-index: 3;
    display: none;
  }
  #startMenu .header {
    padding: 14px 16px 10px 16px;
    font-weight: bold;
    font-size: 19px;
    border-bottom: 1px solid #29466c;
    letter-spacing: 0.03em;
    background: #223f66;
    border-radius: 14px 14px 0 0;
  }
  #startMenu ul {
    list-style: none;
    margin: 0;
    padding: 0;
  }
  #startMenu li {
    padding: 14px 20px;
    cursor: pointer;
    font-size: 16px;
    transition: background 0.18s;
  }
  #startMenu li:hover {
    background: #37507b;
  }
  #window {
    display: none;
    flex-direction: column;
    position: absolute;
    top: 90px;
    left: 270px;
    width: 440px;
    height: 330px;
    background: #f7fafe;
    border-radius: 12px;
    box-shadow: 2px 4px 32px #0005;
    z-index: 10;
    border: 1px solid #cdd6e6;
    min-width: 230px;
    min-height: 170px;
    transition: all 0.3s ease;
  }
  #window.fullscreen {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    z-index: 9999;
  }
  #window .win-header {
    background: #0078d7;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 20px 8px 20px;
    border-radius: 12px 12px 0 0;
    font-weight: bold;
    font-size: 17px;
  }
  #window .win-header button {
    background: none;
    border: none;
    color: #fff;
    font-size: 18px;
    cursor: pointer;
    font-weight: bold;
    margin-left: 10px;
  }
  #windowContent {
    flex: 1;
    padding: 0;
    color: #111b39;
    background: #f6fafd;
    border-radius: 0 0 12px 12px;
    overflow: auto;
    font-size: 15px;
    display: flex;
    flex-direction: column;
  }
  #time {
    margin-left: auto;
    margin-right: 22px;
    font-size: 18px;
    letter-spacing: 0.03em;
    color: #ededed;
    text-shadow: 0 1px 0 #2225;
  }
  @media (max-width: 600px) {
    #window {
      left: 2vw;
      width: 95vw;
      top: 85px;
      min-width: 160px;
      min-height: 170px;
    }
    #startMenu {
      left: 0;
      width: 85vw;
    }
    #desktopIcons {
      left: 6px;
      gap: 10px;
    }
    .icon {
      width: 62px;
    }
    .icon svg {
      width: 30px;
      height: 30px;
    }
  }
  #viewPane {
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
  }
  #viewPane::-webkit-scrollbar {
    width: 7px;
  }
  #viewPane::-webkit-scrollbar-thumb {
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 10px;
  }
</style>
</head>
<body>
<div id="desktop">
  <img id="wallpaper" alt="Wallpaper" src="data:image/jpeg;base64,...(your wallpaper base64 here)..." />
  <div id="desktopIcons">
    <div class="icon" onclick="openWindow('explorer')">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36">
        <rect x="2" y="10" width="32" height="20" rx="3" fill="#ffcc4d"/>
        <rect x="2" y="14" width="32" height="16" rx="3" fill="#ffe066"/>
        <rect x="2" y="10" width="32" height="8" rx="3" fill="#f9d923"/>
      </svg>
      <span>Explorer</span>
    </div>
    <div class="icon" onclick="openWindow('browser')">
      <svg viewBox="0 0 38 38" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="19" cy="19" r="18" fill="#5ACFFA"/>
        <path d="M25 25.3C24.7 28.5 21.7 31 16.9 31C11 31 7 25.7 7 20.2C7 15.9 10.4 11.7 16 11.7C21.5 11.7 25.5 16 25.5 20.2C25.5 22.3 24.7 24.2 23.5 25.5H25Z" fill="#0078D7"/>
      </svg>
      <span>Edge</span>
    </div>
    <div class="icon" onclick="openWindow('settings')">
      <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="24" cy="24" r="18" fill="#eee"/>
        <circle cx="24" cy="24" r="7" fill="#0078D7"/>
        <rect x="12" y="23" width="24" height="2" rx="1" fill="#0078D7"/>
        <rect x="23" y="12" width="2" height="24" rx="1" fill="#0078D7"/>
      </svg>
      <span>Settings</span>
    </div>
  </div>

  <div id="taskbar">
    <button id="startBtn" title="Start">
      <svg viewBox="0 0 36 36">
        <rect x="0" y="0" width="16" height="16" fill="#fff"/>
        <rect x="20" y="0" width="16" height="16" fill="#fff"/>
        <rect x="0" y="20" width="16" height="16" fill="#fff"/>
        <rect x="20" y="20" width="16" height="16" fill="#fff"/>
      </svg>
    </button>
    <div id="time"></div>
  </div>

  <div id="startMenu">
    <div class="header">Start</div>
    <ul>
      <li onclick="openWindow('explorer')">File Explorer</li>
      <li onclick="openWindow('browser')">Edge Browser</li>
      <li onclick="openWindow('settings')">Settings</li>
      <li onclick="shutdownSim()">Shut Down</li>
    </ul>
  </div>

  <div id="window">
    <div class="win-header">
      <span id="winTitle"></span>
      <button onclick="closeWindow()" title="Close">&times;</button>
    </div>
    <div id="windowContent"></div>
  </div>
</div>

<div id="shutdownOverlay" style="display:none;position:fixed;z-index:99;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;font-size:2em;color:#fff;">
  <div>
    <span style="display:block;font-size:3em;margin-bottom:1em;">&#x23FB;</span>
    <div>Shutting down...</div>
  </div>
</div>

<script>
  function clockTick() {
    let now = new Date(),
      h = String(now.getHours()).padStart(2, '0'),
      m = String(now.getMinutes()).padStart(2, '0');
    document.getElementById('time').textContent = h + ':' + m;
  }
  setInterval(clockTick, 30000);
  clockTick();

  const startBtn = document.getElementById('startBtn');
  const startMenu = document.getElementById('startMenu');
  startBtn.onclick = e => {
    e.stopPropagation();
    startMenu.style.display = (startMenu.style.display === 'block') ? 'none' : 'block';
  };
  document.addEventListener('click', e => {
    if (!startMenu.contains(e.target) && e.target !== startBtn) {
      startMenu.style.display = 'none';
    }
  });

  let GOOGLE_KEY = '',
      GOOGLE_CX = '',
      YOUTUBE_API_KEY = '',
      hist = [],
      idx = -1,
      currentTab = 'web';

  function promptGoogleKey() {
    const prompt = document.getElementById('googleKeyPrompt');
    prompt.style.display = 'block';
    document.getElementById('gApiInput').value = GOOGLE_KEY;
    document.getElementById('gCxInput').value = GOOGLE_CX;
    document.getElementById('gApiInput').focus();
    document.getElementById('gApiInput').onkeyup = checkKeys;
    document.getElementById('gCxInput').onkeyup = checkKeys;

    function checkKeys() {
      const key = document.getElementById('gApiInput').value.trim();
      const cx = document.getElementById('gCxInput').value.trim();
      document.getElementById('gApiInput').style.borderColor = key ? '#0078D7' : 'red';
      document.getElementById('gCxInput').style.borderColor = cx ? '#0078D7' : 'red';
    }
    document.getElementById('gApiInput').onpaste = checkKeys;
    document.getElementById('gCxInput').onpaste = checkKeys;

    document.getElementById('gApiInput').onchange = checkKeys;
    document.getElementById('gCxInput').onchange = checkKeys;

    document.getElementById('gApiInput').addEventListener('input', checkKeys);
    document.getElementById('gCxInput').addEventListener('input', checkKeys);

    document.getElementById('gApiInput').dispatchEvent(new Event('input'));
    document.getElementById('gCxInput').dispatchEvent(new Event('input'));

    document.getElementById('gApiInput').focus();

    document.getElementById('gApiInput').addEventListener('keydown', e => {
      if (e.key === 'Enter') document.getElementById('gApiInput').blur();
    });
    document.getElementById('gCxInput').addEventListener('keydown', e => {
      if (e.key === 'Enter') document.getElementById('gCxInput').blur();
    });

    document.getElementById('gApiInput').addEventListener('blur', e => {
      GOOGLE_KEY = e.target.value.trim();
      if (GOOGLE_KEY && GOOGLE_CX) prompt.style.display = 'none';
    });
    document.getElementById('gCxInput').addEventListener('blur', e => {
      GOOGLE_CX = e.target.value.trim();
      if (GOOGLE_KEY && GOOGLE_CX) prompt.style.display = 'none';
    });

    document.getElementById('gApiInput').dispatchEvent(new Event('blur'));
    document.getElementById('gCxInput').dispatchEvent(new Event('blur'));

    document.getElementById('gApiInput').focus();
  }

  function promptYouTubeKey() {
    const prompt = document.getElementById('ytPrompt') || document.getElementById('ytPrompt');
    // Display marker for prompt if exists
    const p = document.getElementById('ytPrompt') || document.createElement('div');
    p.id = 'ytPrompt';
    p.style.cssText = 'padding:10px;background:#f2dede;color:#a94442;border:1px solid #ebccd1;margin:10px 0;border-radius:4px;display:none;';
    p.innerHTML = `
      You need to enter a valid <b>YouTube Data API key</b> to search videos. Get one at <a href='https://console.developers.google.com/apis/credentials' target='_blank' rel='noopener noreferrer'>Google Cloud Console</a>.
    `;
    if (!document.getElementById('ytPrompt')) document.body.appendChild(p);
    p.style.display = 'block';
  }

  function buildGoogleUrl(query, tab) {
    const params = new URLSearchParams({
      key: GOOGLE_KEY,
      cx: GOOGLE_CX,
      q: query,
    });
    if (tab === 'images') params.append('searchType', 'image');
    if (tab === 'news') {
      params.append('num', '10');
      params.append('gl', 'us');
      params.append('sort', 'date');
      params.append('dateRestrict', 'd1');
    }
    if (tab === 'videos') params.append('siteSearch', 'youtube.com');
    return `https://www.googleapis.com/customsearch/v1?${params.toString()}`;
  }

  async function googleSearch(query, tab) {
    if (!GOOGLE_KEY || !GOOGLE_CX) {
      promptGoogleKey();
      throw 'Google API key or CX missing';
    }
    const response = await fetch(buildGoogleUrl(query, tab));
    if (!response.ok) throw `Google Search error ${response.status}`;
    const json = await response.json();
    return json.items || [];
  }

  function extractYouTubeID(url) {
    try {
      const u = new URL(url);
      if (u.hostname.includes('youtube.com')) return u.searchParams.get('v');
      if (u.hostname.includes('youtu.be')) return u.pathname.substring(1);
    } catch { }
    return null;
  }

  async function youtubeSearch(query) {
    if (!YOUTUBE_API_KEY) {
      promptYouTubeKey();
      throw 'YouTube API key missing';
    }
    const apiUrl = new URL('https://www.googleapis.com/youtube/v3/search');
    apiUrl.searchParams.set('part', 'snippet');
    apiUrl.searchParams.set('q', query);
    apiUrl.searchParams.set('type', 'video');
    apiUrl.searchParams.set('maxResults', '15');
    apiUrl.searchParams.set('key', YOUTUBE_API_KEY);
    const response = await fetch(apiUrl);
    if (!response.ok) throw `YouTube Search error ${response.status}`;
    const json = await response.json();
    return json.items || [];
  }

  function setupGoogleMiniBrowser() {
    const addr = document.getElementById('addr');
    const backBtn = document.getElementById('backBtn');
    const fwdBtn = document.getElementById('fwdBtn');
    const goBtn = document.getElementById('goBtn');
    const view = document.getElementById('viewPane');
    const fullScreenBtn = document.getElementById('fullScreenBtn');
    const win = document.getElementById('window');
    let isFullscreen = false;
    let historyStack = [];
    let historyIndex = -1;
    let currentTab = 'web';

    function updateNavButtons() {
      backBtn.disabled = historyIndex <= 0;
      fwdBtn.disabled = historyIndex >= historyStack.length - 1;
    }

    function navigateTo(url) {
      if (historyIndex < historyStack.length - 1) {
        historyStack = historyStack.slice(0, historyIndex + 1);
      }
      historyStack.push(url);
      historyIndex++;
      updateNavButtons();
      loadURL(url);
    }

    function loadURL(url) {
      addr.value = url;
      tryEmbed(url);
    }

    backBtn.addEventListener('click', () => {
      if (historyIndex > 0) {
        historyIndex--;
        loadURL(historyStack[historyIndex]);
        updateNavButtons();
      }
    });

    fwdBtn.addEventListener('click', () => {
      if (historyIndex < historyStack.length - 1) {
        historyIndex++;
        loadURL(historyStack[historyIndex]);
        updateNavButtons();
      }
    });

    const tabs = document.querySelectorAll('.g-tab');
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.style.background = '');
        tab.style.background = '#d8ecff';
        currentTab = tab.getAttribute('data-tab');
      });
    });
    tabs[0].style.background = '#d8ecff';

    function isMediaUrl(url) {
      return /\.(mp4|webm|ogg|mp3|wav|m4a|flac|aac|mov|avi)$/i.test(url);
    }

    async function tryEmbed(url) {
      view.innerHTML = '';
      const videoId = extractYouTubeID(url);
      if (videoId) {
        embedYouTubeVideo(videoId);
        return;
      }
      if (isMediaUrl(url)) {
        const extIsVideo = /\.(mp4|webm|ogg|mov|avi)$/i.test(url);
        const player = document.createElement(extIsVideo ? 'video' : 'audio');
        player.src = url;
        player.controls = true;
        player.autoplay = true;
        player.style.width = '100%';
        if (extIsVideo) player.style.height = 'auto';
        view.appendChild(player);
        return;
      }
      const iframe = document.createElement('iframe');
      iframe.src = url;
      iframe.style.width = '100%';
      iframe.style.height = '255px';
      iframe.style.border = 'none';
      iframe.style.borderRadius = '5px';
      iframe.setAttribute('sandbox', 'allow-scripts allow-forms allow-popups allow-presentation');
      iframe.setAttribute('allow', 'accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture');
      iframe.setAttribute('allowfullscreen', '');
      iframe.onerror = () => failIframe(url);
      view.appendChild(iframe);
      // Detect if iframe didn't load content (due to e.g. framebusting)
      setTimeout(() => {
        try {
          if (!iframe.contentDocument || iframe.contentDocument.body.innerHTML === '') {
            failIframe(url);
          }
        } catch {}
      }, 2000);
    }

    function failIframe(url) {
      view.innerHTML = `<div style="padding:1em;">This site blocks embedding.<br><button onclick="window.open('${url}', '_blank')" style="margin-top:0.5em;padding:5px 10px;">Open in new tab</button></div>`;
    }

    async function navigateSearch(query) {
      if (currentTab === 'videos') {
        if (!YOUTUBE_API_KEY) {
          promptYouTubeKey();
          view.innerHTML = `<div style="padding:1em;color:#a33;">YouTube API key needed to search videos</div>`;
          return;
        }
        try {
          const ytResults = await youtubeSearch(query);
          renderYouTubeResults(ytResults);
        } catch(err) {
          view.innerHTML = `<div style="padding:1em;color:#a33;">YouTube search error: ${err}</div>`;
        }
      } else {
        if (!GOOGLE_KEY || !GOOGLE_CX) {
          promptGoogleKey();
          view.innerHTML = `<div style="padding:1em;color:#a33;">Google API key and CX required</div>`;
          return;
        }
        try {
          const results = await googleSearch(query, currentTab);
          renderGoogleResults(results);
        } catch(err) {
          view.innerHTML = `<div style="padding:1em;color:#a33;">Google search error: ${err}</div>`;
        }
      }
    }

    function renderYouTubeResults(results) {
      const view = document.getElementById('viewPane');
      view.innerHTML = '';
      if (!results.length) {
        view.innerHTML = '<div style="padding:1em;">No results found.</div>';
        return;
      }
      results.forEach(video => {
        const id = video.id.videoId;
        const title = video.snippet.title;
        const thumbnail = video.snippet.thumbnails.medium.url;
        const elem = document.createElement('div');
        elem.style.cursor = 'pointer';
        elem.style.display = 'flex';
        elem.style.marginBottom = '12px';
        elem.style.alignItems = 'center';

        const img = document.createElement('img');
        img.src = thumbnail;
        img.alt = title;
        img.style.width = '120px';
        img.style.height = '70px';
        img.style.objectFit = 'cover';
        img.style.marginRight = '12px';

        const titleDiv = document.createElement('div');
        titleDiv.textContent = title;
        titleDiv.style.fontWeight = 'bold';
        titleDiv.style.flex = '1';

        elem.appendChild(img);
        elem.appendChild(titleDiv);

        elem.addEventListener('click', () => {
          embedYouTubeVideo(id);
        });
        view.appendChild(elem);
      });
    }

    function renderGoogleResults(results) {
      const view = document.getElementById('viewPane');
      view.innerHTML = '';
      if (!results.length) {
        view.innerHTML = '<div style="padding:1em;">No results found.</div>';
        return;
      }
      results.forEach(item => {
        const a = document.createElement('a');
        a.href = '#';
        a.textContent = item.title || item.link;
        a.style.display = 'block';
        a.style.fontWeight = 'bold';
        a.style.margin = '6px 0';
        a.addEventListener('click', e => {
          e.preventDefault();
          tryEmbed(item.link);
        });
        view.appendChild(a);

        const snippet = document.createElement('p');
        snippet.textContent = item.snippet || '';
        snippet.style.margin = '0 0 10px';
        view.appendChild(snippet);
      });
    }

    function embedYouTubeVideo(videoId) {
      const view = document.getElementById('viewPane');
      view.innerHTML = `<iframe
        src="https://www.youtube-nocookie.com/embed/${videoId}?rel=0&playsinline=1&autoplay=1"
        sandbox="allow-scripts allow-forms allow-popups allow-presentation"
        allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen
        style="width: 100%; height: 360px; border: none; border-radius: 6px;">
      </iframe>`;
    }

    // Initialize framework after DOM ready
    document.addEventListener('DOMContentLoaded', () => {
      // Optionally open the browser window on load
    });
  </script>
</body>
</html>

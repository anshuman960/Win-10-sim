<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Win10 Sim — Fixed DDG & YouTube</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
/* ———— core layout (unchanged UI) ———— */
html,body{margin:0;height:100%;overflow:hidden;font-family:'Segoe UI',Arial,sans-serif;background:#276ac6}
#desktop{position:relative;width:100%;height:100%}
#wallpaper{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;user-select:none;pointer-events:none;z-index:0}
.desktop-icon{width:76px;display:flex;flex-direction:column;align-items:center;color:#fff;text-shadow:0 1px 7px #000a;margin:18px 0 0 20px;cursor:pointer;user-select:none}
.desktop-icon svg{width:38px;height:38px;background:#1d6bbb99;border-radius:7px;padding:3px;margin-bottom:4px}
.desktop-icon span{font-size:13px;text-align:center}
#taskbar{position:absolute;bottom:0;width:100%;height:46px;background:rgba(34,43,68,.96);display:flex;align-items:center;z-index:3}
#startBtn{width:40px;height:40px;margin-left:10px;background:none;border:none;display:flex;justify-content:center;align-items:center;cursor:pointer}
#startBtn svg{width:32px;height:32px;fill:#fff}
#time{margin-left:auto;margin-right:22px;font-size:18px;color:#ededed;text-shadow:0 1px 0 #2225}
#startMenu{position:absolute;left:10px;bottom:60px;width:260px;background:rgba(36,39,51,.97);color:#fff;border-radius:14px 14px 0 0;box-shadow:0 9px 30px #0007;display:none;z-index:4}
#startMenu .hdr{padding:14px 16px 10px;font-weight:700;font-size:19px;border-bottom:1px solid #29466c;background:#223d63a4;border-radius:14px 14px 0 0}
#startMenu li{padding:14px 20px;font-size:16px;cursor:pointer;transition:background .18s}
#startMenu li:hover{background:#37507b}
.win{position:absolute;top:90px;left:270px;width:600px;height:430px;background:#f7fafe;border-radius:12px;box-shadow:2px 4px 32px #0005;border:1px solid #cdd6e6;display:none;flex-direction:column;z-index:5}
.win-header{background:#0078d7;color:#fff;padding:12px 14px 8px 20px;font-weight:700;font-size:17px;display:flex;justify-content:space-between;align-items:center;cursor:move;border-radius:12px 12px 0 0;user-select:none}
.win-header button{background:none;border:none;color:#fff;font-size:19px;font-weight:700;cursor:pointer}
#winContent{flex:1;display:flex;flex-direction:column}
#browserBar{display:flex;gap:4px;padding:7px;background:#eef2fa;border-bottom:1px solid #ccd8e9}
#addr{flex:1;padding:6px 8px;border:1px solid #b7c6dc;border-radius:4px;font-size:14px}
#browserBar button{background:#0078d7;border:none;color:#fff;padding:6px 12px;font-size:14px;border-radius:4px;cursor:pointer}
#browserBar .nav{width:32px}
#iframePane{flex:1;border:none;width:100%}
#shutdownOverlay{position:fixed;inset:0;background:#222b448f;color:#fff;font-size:2em;display:none;align-items:center;justify-content:center;flex-direction:column;z-index:99}
@media(max-width:600px){.win{left:2vw;top:85px;width:95vw}.desktop-icon{width:62px;margin-left:6px}.desktop-icon svg{width:30px;height:30px}#startMenu{width:85vw;left:0}}
</style>
</head>
<body>
<div id="desktop">
  <img id="wallpaper" src="" alt="">
  <div class="desktop-icon" ondblclick="openApp('browser')">
    <svg viewBox="0 0 38 38"><circle cx="19" cy="19" r="18" fill="#5AC8FA"/><path d="M25 25.3C24.7 28.5 21.7 31 16.9 31C11 31 7 25.7 7 20.2C7 15.9 10.8 12 16.7 12C20.4 12 23.2 13.9 24.7 17.1H17.8C14.2 17.1 13.7 21.2 17.3 21.2H31.2V20.6C31.2 13.9 26.1 7.6 16.8 7.6C8.8 7.6 3 13.3 3 20.5C3 28.1 10.2 34 17.8 34C27.1 34 33.5 27.8 33.5 20.2H25V25.3Z" fill="#0078D7"/></svg>
    <span>Edge</span>
  </div>
  <div class="desktop-icon" ondblclick="openApp('yt')">
    <svg viewBox="0 0 50 35"><rect width="50" height="35" rx="7" fill="#FF0000"/><polygon points="20,10 38,17.5 20,25" fill="#fff"/></svg>
    <span>YouTube</span>
  </div>
</div>

<div id="taskbar">
  <button id="startBtn"><svg viewBox="0 0 36 36"><rect width="16" height="16"/><rect x="20" width="16" height="16"/><rect y="20" width="16" height="16"/><rect x="20" y="20" width="16" height="16"/></svg></button>
  <div id="time"></div>
</div>

<div id="startMenu">
  <div class="hdr">Start</div>
  <ul>
    <li onclick="openApp('browser')">Edge Browser</li>
    <li onclick="openApp('yt')">YouTube</li>
    <li onclick="shutdownSim()">Shut Down</li>
  </ul>
</div>

<div id="win" class="win">
  <div class="win-header" onmousedown="startDrag(event)">
    <span id="winTitle"></span><button onclick="closeWin()">×</button>
  </div>
  <div id="winContent"></div>
</div>

<div id="shutdownOverlay"><span style="font-size:3em;margin-bottom:.3em">⏻</span>Shutting down…</div>

<script>
/* ── utilities ────────────────────────────── */
const $ = sel => document.querySelector(sel);
function clock(){const d=new Date();$('#time').textContent=d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});}
setInterval(clock,3e4);clock();
window.onload=()=>{$('#wallpaper').style.background=['#276ac6','#1d1f30','#4e8ff5','#8ac4ff'][Math.random()*4|0];};

/* ── start menu ───────────────────────────── */
$('#startBtn').onclick=e=>{e.stopPropagation();$('#startMenu').style.display=$('#startMenu').style.display==='block'?'none':'block';};
document.addEventListener('click',()=>$('#startMenu').style.display='none');

/* ── draggable window ─────────────────────── */
let sx,sy;
function startDrag(e){sx=e.clientX- win.offsetLeft;sy=e.clientY-win.offsetTop;
  document.onmousemove=ev=>{win.style.left=ev.clientX-sx+'px';win.style.top=ev.clientY-sy+'px';};
  document.onmouseup=()=>document.onmousemove=null;}

/* ── smart URL / search logic ─────────────── */
function smartURL(text){
  text=text.trim();
  if(/^https?:\/\//i.test(text)) return text;            // full URL
  if(/^[\\w-]+(\\.[\\w-]+)+/i.test(text)) return 'https://'+text; // bare domain
  return 'https://duckduckgo.com/search.html?q='+encodeURIComponent(text); // iframe-safe search
}

/* ── pick first live Piped/Invidious mirror ─ */
async function findMirror(){
  const mirrors=[
    'https://piped.video',
    'https://piped.adminforge.de',
    'https://yewtu.be',
    'https://piped.video.lol'
  ];
  for(const m of mirrors){
    try{
      const r=await fetch(m+'/favicon.ico',{mode:'no-cors'}); // quick HEAD-ish
      return m;
    }catch{}
  }
  return null;
}

/* ── browser UI loader ────────────────────── */
function loadFrame(url,showNav){
  $('#winContent').innerHTML=
  `<div id="browserBar">
     ${showNav?'<button class="nav" id="backBtn">←</button><button class="nav" id="fwdBtn">→</button>':''}
     <input id="addr" placeholder="Type URL or search" autocomplete="off">
     <button id="goBtn">Go</button>
   </div>
   <iframe id="iframePane" sandbox="allow-scripts allow-same-origin allow-forms allow-popups" src="${url}"></iframe>`;
  setupBrowser(showNav,url);
}

/* ── browser history & nav ────────────────── */
function setupBrowser(nav,url){
  const view=$('#iframePane'),addr=$('#addr'),go=$('#goBtn');
  let hist=[url],idx=0;
  function upd(){ if(nav){$('#backBtn').disabled=idx<=0; $('#fwdBtn').disabled=idx>=hist.length-1;} }
  function goURL(u){u=smartURL(u);view.src=u;addr.value=u;hist=hist.slice(0,idx+1);hist.push(u);idx++;upd();}
  go.onclick=()=>goURL(addr.value); addr.onkeydown=e=>e.key==='Enter'&&goURL(addr.value);
  if(nav){ $('#backBtn').onclick=()=>{if(idx>0){idx--;view.src=hist[idx];addr.value=hist[idx];upd();}};
           $('#fwdBtn').onclick=()=>{if(idx<hist.length-1){idx++;view.src=hist[idx];addr.value=hist[idx];upd();}};}
  view.onerror=()=>{view.replaceWith(Object.assign(document.createElement('div'),
     {style:'padding:1em;font:14px/1.4 sans-serif',innerHTML:`This site won’t load in an iframe.<br><button onclick=\"window.open('${addr.value}','_blank')\">Open in new tab</button>`}));};
  addr.value=url; upd();
}

/* ── open apps ────────────────────────────── */
async function openApp(app){
  $('#win').style.display='flex'; $('#startMenu').style.display='none';
  if(app==='browser'){
    $('#winTitle').textContent='Edge Browser';
    loadFrame('https://duckduckgo.com/search.html?q=',true);
  }else if(app==='yt'){
    $('#winTitle').textContent='YouTube';
    const mirror=await findMirror();
    if(mirror){ loadFrame(mirror+'/',false); }
    else{ $('#winContent').innerHTML='<p style=\"padding:1em;font:15px sans-serif\">No Piped/Invidious mirrors are currently reachable.<br><button onclick=\"window.open(\\'https://youtube.com\\',\\'_blank\\')\">Open YouTube in new tab</button></p>'; }
  }
}

/* ── close / shutdown ─────────────────────── */
function closeWin(){ $('#win').style.display='none'; }
function shutdownSim(){ closeWin(); $('#startMenu').style.display='none'; $('#shutdownOverlay').style.display='flex';
  setTimeout(()=>$('#shutdownOverlay').innerHTML='<div style=\"text-align:center;margin-top:40vh\">Your PC is off.<br>Reload to start.</div>',1500);}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Windows 10 Simulator</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  /* Reset and base styles */
  html, body {
    margin:0; padding:0; width:100vw; height:100vh; overflow:hidden;
    font-family: 'Segoe UI', Arial, sans-serif;
    background: #276ac6;
  }
  #desktop {
    position:relative;
    width:100vw; height:100vh;
    overflow:hidden;
  }
  #wallpaper {
    position:absolute; top:0; left:0; width:100vw; height:100vh;
    object-fit:cover; user-select:none; pointer-events:none;
    z-index:0;
  }
  #taskbar {
    position:absolute; bottom:0; left:0; width:100vw; height:46px;
    background: rgba(34,43,68,0.96);
    display:flex; align-items:center; z-index:2;
  }
  #startBtn {
    margin-left:10px; width:40px; height:40px;
    background:none; border:none; padding:0;
    cursor:pointer; display:flex; align-items:center; justify-content:center;
  }
  #startBtn svg {
    width:32px; height:32px; display:block;
  }
  #desktopIcons {
    position:absolute; top:24px; left:20px; z-index:1;
    display:flex; flex-direction:column; gap:18px;
  }
  .icon {
    width:76px; cursor:pointer; user-select:none;
    display:flex; flex-direction:column; align-items:center;
    color:#fff; text-shadow:0 1px 7px #000a;
  }
  .icon svg {
    width:38px; height:38px; margin-bottom:4px;
    background:#1d6bbb99; border-radius:7px; padding:3px; box-sizing:content-box;
  }
  .icon span {
    font-size:13px; margin-top:0; text-align:center; word-break:break-word;
  }
  #startMenu {
    position:absolute; left:10px; bottom:60px; width:260px;
    background: rgba(36,39,51,0.97);
    color: #fff;
    border-radius:14px 14px 0 0;
    box-shadow:0 9px 30px #0007;
    z-index:3;
    display:none;
  }
  #startMenu .header {
    padding: 14px 16px 10px 16px;
    font-weight:bold;
    font-size:19px;
    border-bottom:1px solid #29466c;
    letter-spacing: 0.03em;
    background:#223d63a4;
    border-radius:14px 14px 0 0;
  }
  #startMenu ul {
    margin:0; padding:0; list-style:none;
  }
  #startMenu li {
    padding:14px 20px;
    cursor:pointer;
    font-size:16px;
    transition: background 0.18s;
  }
  #startMenu li:hover {
    background:#37507b;
  }
  #window {
    display:none;
    position:absolute;
    top:90px; left:270px;
    width:440px; height:330px;
    background:#f7fafe;
    border-radius:12px;
    box-shadow:2px 4px 32px #0005;
    border:1px solid #cdd6e6;
    z-index:10;
    min-width:230px;
    min-height:170px;
    transition: all 0.3s ease;
    flex-direction: column;
  }
  #window.fullscreen {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    z-index: 9999 !important;
  }
  #window .win-header {
    background: #0078d7;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 20px 8px;
    border-radius: 12px 12px 0 0;
    font-weight: bold;
    font-size: 17px;
  }
  #window .win-header button {
    background: none;
    border: none;
    color: #fff;
    font-size: 18px;
    cursor: pointer;
    font-weight: bold;
    margin-left: 10px;
  }
  #windowContent {
    background: #f6fafd;
    color: #111b3a;
    padding: 0;
    font-size: 15px;
    border-radius: 0 0 12px 12px;
    flex: 1;
    overflow: auto;
    display: flex;
    flex-direction: column;
  }
  #time {
    margin-left: auto;
    margin-right: 22px;
    color: #ededed;
    text-shadow: 0 1px 0 #2225;
    font-size: 18px;
    letter-spacing: 0.03em;
  }
  @media (max-width:600px){
    #window {
      left: 2vw;
      width: 95vw;
      top: 85px;
      min-width: 160px;
      min-height: 80px;
    }
    #startMenu {
      left: 0;
      width: 85vw;
    }
    #desktopIcons {
      left: 6px;
      gap: 10px;
    }
    .icon {
      width: 62px;
    }
    .icon svg {
      width: 30px;
      height: 30px;
    }
  }
  #viewPane {
    scrollbar-width: thin;
    scrollbar-color: rgba(0,0,0,0.2) transparent;
  }
  #viewPane::-webkit-scrollbar {
    width: 7px;
  }
  #viewPane::-webkit-scrollbar-thumb {
    background-color: rgba(0,0,0,0.2);
    border-radius: 10px;
  }
</style>
</head>
<body>
<div id="desktop">
  <img id="wallpaper" alt="Wallpaper" src="data:image/jpeg;base64,...YOUR_WALLPAPER_BASE64_HERE..." />
  <div id="desktopIcons">
    <div class="icon" onclick="openWindow('explorer')">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36">
        <rect x="2" y="10" width="32" height="20" rx="3" fill="#ffcc4d"/>
        <rect x="2" y="14" width="32" height="16" rx="3" fill="#ffe066"/>
        <rect x="2" y="10" width="32" height="8" rx="3" fill="#f9d923"/>
      </svg>
      <span>Explorer</span>
    </div>
    <div class="icon" onclick="openWindow('browser')">
      <svg viewBox="0 0 38 38" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="19" cy="19" r="18" fill="#5AC8FA"/>
        <path d="M25 25.3C24.7 28.5 21.7 31 16.9 31C11 31 7 25.7 7 20.2C7 15.9 10.8 12 16.7 12C20.4 12 23.2 13.9 24.7 17.1H17.8C14.2 17.1 13.7 21.2 17.3 21.2H31.2V20.6C31.2 13.9 26.1 7.6 16.8 7.6C8.8 7.6 3 13.3 3 20.5C3 28.1 10.2 34 17.8 34C27.1 34 33.5 27.8 33.5 20.2H25V25.3Z" fill="#0078D7"/>
      </svg>
      <span>Edge</span>
    </div>
    <div class="icon" onclick="openWindow('settings')">
      <svg viewBox="0 0 48 48" width="38" height="38" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="24" cy="24" r="18" fill="#eee"/>
        <circle cx="24" cy="24" r="7" fill="#0078D7"/>
        <rect x="12" y="23" width="24" height="2" rx="1" fill="#0078D7"/>
        <rect x="23" y="12" width="2" height="24" rx="1" fill="#0078D7"/>
      </svg>
      <span>Settings</span>
    </div>
  </div>
  <div id="taskbar">
    <button id="startBtn" title="Start">
      <svg viewBox="0 0 36 36">
        <rect x="0" y="0" width="16" height="16" fill="#fff"/>
        <rect x="20" y="0" width="16" height="16" fill="#fff"/>
        <rect x="0" y="20" width="16" height="16" fill="#fff"/>
        <rect x="20" y="20" width="16" height="16" fill="#fff"/>
      </svg>
    </button>
    <div id="time"></div>
  </div>
  <div id="startMenu">
    <div class="header">Start</div>
    <ul>
      <li onclick="openWindow('explorer')">File Explorer</li>
      <li onclick="openWindow('browser')">Edge Browser</li>
      <li onclick="openWindow('settings')">Settings</li>
      <li onclick="shutdownSim()">Shut Down</li>
    </ul>
  </div>
  <div id="window">
    <div class="win-header">
      <span id="winTitle"></span>
      <button onclick="closeWindow()" title="Close">&times;</button>
    </div>
    <div id="windowContent"></div>
  </div>
</div>
<div id="shutdownOverlay" style="display:none;position:fixed;z-index:99;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.55);justify-content:center;align-items:center;font-size:2em;color:#fff;">
  <div>
    <span style="display:block;font-size:3em;margin-bottom:0.5em;">&#x23FB;</span>
    <div>Shutting down...</div>
  </div>
</div>

<script>
  // Clock update
  function clockTick(){
    const now = new Date();
    const h = String(now.getHours()).padStart(2, '0');
    const m = String(now.getMinutes()).padStart(2, '0');
    document.getElementById('time').textContent = `${h}:${m}`;
  }
  setInterval(clockTick, 30000);
  clockTick();

  // Start menu toggle
  const startBtn = document.getElementById('startBtn');
  const startMenu = document.getElementById('startMenu');
  startBtn.onclick = e => {
    e.stopPropagation();
    startMenu.style.display = (startMenu.style.display === 'block') ? 'none' : 'block';
  };
  document.addEventListener('click', e => {
    if(!startMenu.contains(e.target) && e.target !== startBtn){
      startMenu.style.display = 'none';
    }
  });

  // Globals
  let GOOGLE_KEY = '', GOOGLE_CX = '', YOUTUBE_API_KEY = '';
  let historyStack = [], historyIndex = -1;
  let currentTab = 'web';

  function openWindow(app){
    const win = document.getElementById('window');
    const winContent = document.getElementById('windowContent');
    const winTitle = document.getElementById('winTitle');
    startMenu.style.display = 'none';
    win.style.display = 'flex';

    if(app === 'browser'){
      winTitle.textContent = "Web Browser";
      winContent.innerHTML = `
      <div id="googleKeyPrompt" style="display:none;padding:12px;background:#fff5e1;margin-bottom:8px;border-radius:7px;">
        <b>Google Programmable Search API key + CX</b><br>
        <label>API Key: <input id="gApiInput" style="width:250px;"></label><br>
        <label>CX: <input id="gCxInput" style="width:250px;"></label><br>
        <button id="gKeySave" style="margin-top:6px;padding:5px 12px;background:#0078d7;color:#fff;border:none;border-radius:6px;">Save</button>
        <small>No card needed, not stored. Get keys <a href="https://developers.google.com/custom-search/v1/introduction" target="_blank" rel="noopener">here</a>.</small>
      </div>
      <div id="ytKeyPrompt" style="display:none;padding:12px;background:#fff1f1;margin-bottom:8px;border-radius:7px;">
        <b>YouTube Data API v3 key</b><br>
        <input id="ytApiInput" type="text" placeholder="Enter your YouTube API key" style="width:100%;padding:6px;">
        <button id="ytKeySave" style="margin-top:6px;padding:5px 12px;background:#e52d27;color:#fff;border:none;border-radius:6px;">Save</button>
        <small>Get one <a href="https://console.developers.google.com/apis/api/youtube.googleapis.com/overview" target="_blank" rel="noopener">Google Cloud Console</a>. Not stored.</small>
      </div>
      <div id="browserBar" style="display:flex;align-items:center;gap:6px;margin-bottom:6px;">
        <button id="backBtn" disabled>←</button>
        <button id="fwdBtn" disabled>→</button>
        <input id="addr" placeholder="Type URL, search or media link…" style="flex:1;padding:6px;font-size:14px;">
        <button id="goBtn" style="padding:6px 12px;background:#0078d7;color:#fff;border:none;border-radius:6px;">Go</button>
        <button id="fullScreenBtn" title="Toggle full screen" style="padding:6px 12px;background:#232f54;color:#fff;border:none;border-radius:6px;margin-left:6px;cursor:pointer;">⛶</button>
      </div>
      <div id="searchTabs" style="display:flex;gap:7px;margin-bottom:9px;">
        <button class="g-tab" data-tab="web" style="background:#d8ecff;border-radius:5px;border:1px solid #bcd2f3;cursor:pointer;">Web</button>
        <button class="g-tab" data-tab="images" style="cursor:pointer;">Images</button>
        <button class="g-tab" data-tab="videos" style="cursor:pointer;">Videos</button>
        <button class="g-tab" data-tab="news" style="cursor:pointer;">News</button>
      </div>
      <div id="viewPane" style="flex:1;overflow:auto;border-radius:6px;box-shadow:0 2px 12px #0002;padding:5px;"></div>`;
      setupBrowser();
      return;
    }
    if(app === 'explorer'){
      winTitle.textContent = "File Explorer";
      winContent.innerHTML = `
      <b>Desktop</b><hr>
      <div><svg height="28" width="28" style="vertical-align:-8px"><rect x="2" y="11" width="22" height="15" rx="2" fill="#ffe066"/></svg> My Game Project</div>
      <div><svg height="24" width="24" style="vertical-align:-6px"><circle cx="12" cy="12" r="11" fill="#c1eaff"/></svg> Reference.png</div>
      <div><svg height="24" width="24" style="vertical-align:-6px"><rect x="4" y="4" width="16" height="16" fill="#aaa"/></svg> README.txt</div>
      <div style="margin-top:14px;color:#567;">Files and folders are simulated. No real file browsing yet.</div>`;
      return;
    }
    if(app === 'settings'){
      winTitle.textContent = "Settings";
      winContent.innerHTML = `
      <label><b>Wallpaper Tint:</b> <input id="wallColor" type="color" value="#276ac6"></label>
      <div>Change background color</div>
      <label style="margin-top:18px;display:block;">
        <b>Night Mode:</b> <input type="checkbox" id="nightModeChk">
      </label>
      <div style="font-size:13px;color:#567;margin-top:10px;">Settings are simulated and not saved.</div>`;
      document.getElementById('wallColor').onchange = e => {
        document.getElementById('wallpaper').style.background = e.target.value;
      };
      document.getElementById('nightModeChk').onchange = e => {
        document.body.style.background = e.target.checked ? '#1b2236' : '#276ac6';
      };
      return;
    }
    winTitle.textContent = "App";
    winContent.textContent = "This is a simulated app.";
  }

  function closeWindow(){
    document.getElementById('window').style.display = 'none';
  }

  document.querySelectorAll('.icon').forEach(icon => {
    icon.ondblclick = () => icon.click();
  });

  function shutdownSim(){
    document.getElementById('startMenu').style.display = 'none';
    document.getElementById('window').style.display = 'none';
    const overlay = document.getElementById('shutdownOverlay');
    overlay.style.display = 'flex';
    setTimeout(() => {
      overlay.innerHTML = '<div style="text-align:center;margin-top:40vh;color:#fff;font-size:2em;">Your PC is now off.<br>Reload page to turn on.</div>';
    }, 1500);
  }

  function setupBrowser(){
    const gKeyPrompt = document.getElementById('googleKeyPrompt');
    const ytKeyPrompt = document.getElementById('ytKeyPrompt');
    const gApiInput = document.getElementById('gApiInput');
    const gCxInput = document.getElementById('gCxInput');
    const ytApiInput = document.getElementById('ytApiInput');
    const backBtn = document.getElementById('backBtn');
    const fwdBtn = document.getElementById('fwdBtn');
    const goBtn = document.getElementById('goBtn');
    const addr = document.getElementById('addr');
    const fullScreenBtn = document.getElementById('fullScreenBtn');
    const viewPane = document.getElementById('viewPane');

    // Load saved keys (session only)
    if(GOOGLE_KEY) { gApiInput.value = GOOGLE_KEY; gCxInput.value = GOOGLE_CX; }
    if(YOUTUBE_API_KEY) ytApiInput.value = YOUTUBE_API_KEY;

    gKeyPrompt.style.display = (GOOGLE_KEY && GOOGLE_CX) ? 'none' : 'block';
    ytKeyPrompt.style.display = YOUTUBE_API_KEY ? 'none' : 'block';

    gApiInput.oninput = () => { GOOGLE_KEY = gApiInput.value.trim(); enableGoIfReady(); };
    gCxInput.oninput = () => { GOOGLE_CX = gCxInput.value.trim(); enableGoIfReady(); };
    ytApiInput.oninput = () => { YOUTUBE_API_KEY = ytApiInput.value.trim(); enableGoIfReady(); };

    document.getElementById('gKeySave').onclick = () => {
      GOOGLE_KEY = gApiInput.value.trim();
      GOOGLE_CX = gCxInput.value.trim();
      if(GOOGLE_KEY && GOOGLE_CX) gKeyPrompt.style.display = 'none';
      enableGoIfReady();
    };

    document.getElementById('ytKeySave').onclick = () => {
      YOUTUBE_API_KEY = ytApiInput.value.trim();
      if(YOUTUBE_API_KEY) ytKeyPrompt.style.display = 'none';
      enableGoIfReady();
    };

    let historyStack = [];
    let historyIndex = -1;

    function enableGoIfReady() {
      if(GOOGLE_KEY && GOOGLE_CX && YOUTUBE_API_KEY){
        goBtn.disabled = false;
        addr.disabled = false;
      }else{
        goBtn.disabled = true;
        addr.disabled = true;
      }
    }
    enableGoIfReady();

    function updateNav() {
      backBtn.disabled = historyIndex <= 0;
      fwdBtn.disabled = historyIndex >= historyStack.length - 1;
    }

    function navigate(url) {
      if(historyIndex < historyStack.length -1){
        historyStack = historyStack.slice(0, historyIndex + 1);
      }
      historyStack.push(url);
      historyIndex++;
      updateNav();
      loadURL(url);
    }

    function loadURL(url){
      addr.value = url;
      tryEmbed(url);
    }

    backBtn.onclick = () => {
      if(historyIndex > 0){
        historyIndex--;
        loadURL(historyStack[historyIndex]);
        updateNav();
      }
    };
    fwdBtn.onclick = () => {
      if(historyIndex < historyStack.length-1){
        historyIndex++;
        loadURL(historyStack[historyIndex]);
        updateNav();
      }
    };

    const tabs = document.querySelectorAll('.g-tab');
    tabs.forEach(tab => tab.onclick = () => {
      tabs.forEach(t=>t.style.background = '');
      tab.style.background = '#d8ecff';
      currentTab = tab.dataset.tab;
      searchCurrent();
    });
    tabs[0].style.background = '#d8ecff';

    goBtn.onclick = () => {
      handleInput(addr.value);
    };
    addr.onkeydown = e => {
      if(e.key === 'Enter'){
        handleInput(addr.value);
      }
    };

    async function handleInput(val){
      val = val.trim();
      if(!val) return;
      if(/^(https?:\/\/)/i.test(val) || /^[\w-]+\.[\w-]+/.test(val)){
        navigate(val.startsWith('http') ? val : 'https://' + val);
        return;
      }
      searchCurrent(val);
    }

    async function searchCurrent(query){
      query = query || addr.value.trim();
      if(!query) return;
      viewPane.innerHTML = "<div style='padding:1em;'>Loading...</div>";
      try{
        if(currentTab === 'videos'){
          const res = await youtubeSearch(query);
          renderYouTubeResults(res);
        }else{
          const res = await googleSearch(query, currentTab);
          renderGoogleResults(res, currentTab);
        }
      }catch(e){
        viewPane.innerHTML = `<div style="padding:1em;color:#a33;">Search failed: ${e}</div>`;
      }
    }

    function renderYouTubeResults(items){
      viewPane.innerHTML = "";
      if(!items.length){
        viewPane.innerHTML = "<div style='padding:1em;'>No results.</div>";
        return;
      }
      items.forEach(item => {
        const id = item.id.videoId;
        const snip = item.snippet;
        const elem = document.createElement('div');
        elem.style.display = 'flex';
        elem.style.marginBottom = '12px';
        elem.style.cursor = 'pointer';
        elem.style.alignItems = 'center';

        const img = document.createElement('img');
        img.src = (snip.thumbnails.medium || snip.thumbnails.default).url;
        img.alt = snip.title;
        img.style.width = '120px';
        img.style.height = '70px';
        img.style.objectFit = 'cover';
        img.style.marginRight = '12px';

        const title = document.createElement('div');
        title.textContent = snip.title;
        title.style.fontWeight = 'bold';
        title.style.flex = '1';

        elem.appendChild(img);
        elem.appendChild(title);

        elem.onclick = () => {
          embedYouTubeVideo(id);
          addHistory(`youtube://watch?v=${id}`);
        };
        viewPane.appendChild(elem);
      });
    }

    function renderGoogleResults(items, tab){
      viewPane.innerHTML = "";
      if(!items.length){
        viewPane.innerHTML = "<div style='padding:1em;'>No results.</div>";
        return;
      }
      items.forEach(item => {
        const a = document.createElement('a');
        a.href = '#';
        a.textContent = item.title || item.link;
        a.style.display = 'block';
        a.style.fontWeight = 'bold';
        a.style.margin = '6px 0';
        a.onclick = e => {
          e.preventDefault();
          navigate(item.link);
        };
        viewPane.appendChild(a);

        const snippet = document.createElement('p');
        snippet.textContent = item.snippet || '';
        snippet.style.margin = '0 0 10px 0';
        viewPane.appendChild(snippet);
      });
    }

    function embedYouTubeVideo(videoId){
      const embedUrl = `https://www.youtube-nocookie.com/embed/${videoId}?rel=0&playsinline=1&autoplay=1`;
      viewPane.innerHTML = `
        <iframe src="${embedUrl}"
          sandbox="allow-scripts allow-forms allow-popups allow-presentation"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
          style="width:100%;height:360px;border:none;border-radius:6px;">
        </iframe>`;
    }

    async function tryEmbed(url){
      viewPane.innerHTML = "";
      const videoId = extractYouTubeID(url);
      if(videoId){
        embedYouTubeVideo(videoId);
        addHistory(url);
        return;
      }
      if(/\.(mp4|webm|ogg|mp3|wav|m4a|flac|aac|mov|avi)$/i.test(url)){
        const isVideo = /\.(mp4|webm|ogg|mov|avi)$/i.test(url);
        const media = document.createElement(isVideo ? 'video' : 'audio');
        media.src = url;
        media.controls = true;
        media.autoplay = true;
        media.style.width = '100%';
        if(isVideo) media.style.height = 'auto';
        viewPane.appendChild(media);
        addHistory(url);
        return;
      }
      const iframe = document.createElement('iframe');
      iframe.src = url;
      iframe.style.width = '100%';
      iframe.style.height = '255px';
      iframe.style.border = 'none';
      iframe.style.borderRadius = '5px';
      iframe.setAttribute('sandbox', 'allow-scripts allow-forms allow-popups allow-presentation');
      iframe.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture');
      iframe.setAttribute('allowfullscreen', '');
      iframe.onerror = () => failIframe(url);
      viewPane.appendChild(iframe);
      addHistory(url);
      setTimeout(() => {
        try {
          if(!iframe.contentDocument || iframe.contentDocument.body.innerHTML === '') {
            failIframe(url);
          }
        } catch {}
      }, 2000);
    }

    function failIframe(url){
      viewPane.innerHTML = `<div style="padding:1em;">Embedding blocked.<br><button onclick="window.open('${url}', '_blank')" style="margin-top:6px;padding:5px 12px;">Open in new tab</button></div>`;
    }

    function addHistory(url){
      if(historyIndex < historyStack.length - 1){
        historyStack = historyStack.slice(0, historyIndex + 1);
      }
      historyStack.push(url);
      historyIndex++;
      updateNav();
    }

    function closeWindow(){
      document.getElementById('window').style.display = 'none';
    }
  </script>
</body>
</html>
